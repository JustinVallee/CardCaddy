<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
    
    <title>CardCaddy</title>

    <style>
        input#result::-webkit-input-placeholder {
            color: #0d6efd;
            opacity: 1;
            font-size: larger;
            font-weight: bolder;
        }
        #result{
            background-color: white;
            text-align: center;
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

</head>
<body>
    <div class="px-4 py-5 my-5 text-center">
        <section>
        <h1 class="display-5 fw-bold">Welcome to CardCaddy</h1>
        <div class="col-lg-6 mx-auto">
          <p class="lead mb-4">CardCaddy is a golf score tracking app that scans and digitizes golf scorecards using OCR technology. It allows players to easily capture scores, calculate averages, and gain insights into their game. The app features team login, customizable player profiles, and supports image uploads and processing via AWS services like Lambda and S3.</p>

          <h1>Upload an Image to Get Total</h1>
    
          <!-- File input to select an image -->
          <input type="file" id="imageInput" accept="image/*">

          <button onclick="main()">Scan and Get Total</button>
      
          <h2>Total: <span id="total">Waiting for image...</span></h2>
          
        </div>
      </div>

      <script>

        function main(){
            // Get the file input element by its id
            const fileInput = document.getElementById("imageInput");

            if(fileInput.files.length > 0) {
                const filename = fileInput.files[0].name;
                const bucket = "jv-image-processing-bucket";
                
                // Call functions to upload the image and process it via Lambda
                uploadImage(bucket, filename);
                getLambdaRekog(bucket, filename);
            } else {
                alert("Please select an image.");
            }
        }

        // Function to upload the image to S3
        function uploadImage(bucket, filename) {
            const fileInput = document.getElementById("imageInput");
            const file = fileInput.files[0];

            if (!file) {
                console.error("No file selected");
                return;
            }

            fetch(`https://tmluaj55ij.execute-api.us-east-2.amazonaws.com/dev/${bucket}/${filename}`, {
                method: 'PUT',
                headers: {
                    "Content-Type": file.type // Automatically set the correct MIME type
                },
                body: file // Pass the file object directly as the body
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Upload failed. Status: ${response.status}`);
                }
                console.log("Image uploaded successfully");
            })
            .catch(error => {
                console.error("Error uploading image:", error);
            });
        }


        // Function to get Lambda Rekognition result for the image
        function getLambdaRekog(bucket, filename) {
        console.log("Bucket:", bucket);
        console.log("Filename:", filename);

        // Send the request to the API
        fetch(`https://j84muscmw3.execute-api.us-east-2.amazonaws.com/dev/${bucket}/${filename}`)
            .then(response => response.json()) // Parse the JSON response
            .then(data => {
                console.log("Rekognition result:", data);

                // Directly access the 'textDetected' from the response
                const total = data.textDetected || "No text detected"; // Fallback to "No text detected" if it's empty

                // Update the DOM element with the result
                document.getElementById("total").innerText = `Text Detected: ${total}`;
            })
            .catch(error => {
                console.error("Error getting Rekognition result:", error);
                document.getElementById("total").innerText = "Error fetching total";
            });
        }
    
    </script>
</body>
</html>
